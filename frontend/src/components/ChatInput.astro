---
// No server-side props needed - all client-side
---

<!-- Sticky input area fixed to bottom -->
<div class="fixed bottom-0 left-0 right-0 border-t border-gray-200 bg-white shadow-lg z-10">
  <div class="max-w-7xl mx-auto p-4">
    <form id="chatForm" class="flex gap-3">
      <textarea
        id="messageInput"
        name="message"
        rows="2"
        maxlength="2000"
        placeholder="Type your message... (Shift+Enter for new line)"
        class="flex-1 px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none resize-none transition"
      ></textarea>
      <button
        type="submit"
        id="sendButton"
        class="px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white font-semibold rounded-lg transition duration-200 disabled:opacity-50 disabled:cursor-not-allowed"
      >
        Send
      </button>
    </form>
    <div class="mt-2 text-xs text-gray-500 flex justify-between items-center">
      <div class="flex items-center gap-4">
        <div class="flex items-center gap-2">
          <label for="modelSelector" class="font-medium text-gray-600">Model:</label>
          <select
            id="modelSelector"
            class="px-3 py-1 border border-gray-300 rounded-md text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition bg-white"
          >
            <option value="claude-haiku-4.5">Claude Haiku 4.5</option>
            <option value="gemini-2.5-flash">Gemini 2.5 Flash</option>
          </select>
        </div>
        <span id="charCount">0 / 2000</span>
      </div>
      <span>Press Enter to send, Shift+Enter for new line</span>
    </div>
  </div>
</div>

<script>
  const form = document.getElementById('chatForm') as HTMLFormElement;
  const input = document.getElementById('messageInput') as HTMLTextAreaElement;
  const sendButton = document.getElementById('sendButton') as HTMLButtonElement;
  const charCount = document.getElementById('charCount') as HTMLSpanElement;

  // Auto-resize textarea (increased max height to 250px)
  function autoResize() {
    input.style.height = 'auto';
    input.style.height = Math.min(input.scrollHeight, 250) + 'px';
  }

  // Update character count
  function updateCharCount() {
    const count = input.value.length;
    charCount.textContent = `${count} / 2000`;

    if (count > 1900) {
      charCount.classList.add('text-orange-600');
    } else {
      charCount.classList.remove('text-orange-600');
    }
  }

  // Handle input
  input.addEventListener('input', () => {
    autoResize();
    updateCharCount();
  });

  // Handle Enter key (send) vs Shift+Enter (new line)
  input.addEventListener('keydown', (e) => {
    if (e.key === 'Enter' && !e.shiftKey) {
      e.preventDefault();
      form.dispatchEvent(new Event('submit'));
    }
  });

  // Model selector
  const modelSelector = document.getElementById('modelSelector') as HTMLSelectElement;

  // Export functions for chat page to use
  (window as any).chatInput = {
    getValue: () => input.value.trim(),
    clear: () => {
      input.value = '';
      autoResize();
      updateCharCount();
    },
    disable: () => {
      input.disabled = true;
      sendButton.disabled = true;
      modelSelector.disabled = true;
    },
    enable: () => {
      input.disabled = false;
      sendButton.disabled = false;
      modelSelector.disabled = false;
    },
    focus: () => {
      input.focus();
    },
    // Model selection
    getModel: () => modelSelector.value,
    setModel: (model: string) => {
      modelSelector.value = model;
    },
    onModelChange: (callback: (model: string) => void) => {
      modelSelector.addEventListener('change', () => callback(modelSelector.value));
    }
  };
</script>
